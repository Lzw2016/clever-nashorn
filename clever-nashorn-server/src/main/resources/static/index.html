<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>首页</title>
    <script src="./vConsole/vconsole.min.js"></script>
    <script>
        // 初始化
        var vConsole = new VConsole({
            defaultPlugins: [],
            onReady: function () {
                $("#__vconsole .vc-panel").css({"min-height": "55%"});
            }
        });
    </script>
    <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="codemirror/lib/codemirror.css">
    <link rel="stylesheet" href="codemirror/theme/monokai.css">
    <link rel="stylesheet" href="codemirror/addon/dialog/dialog.css">
    <link rel="stylesheet" href="codemirror/addon/fold/foldgutter.css">
    <link rel="stylesheet" href="codemirror/addon/scroll/simplescrollbars.css">
    <link rel="stylesheet" href="codemirror/addon/search/matchesonscrollbar.css">
    <style>
        .code-mirror-editor {
            width: 100%;
            height: 100%;
            position: absolute;
            left: 0;
            top: 0;
        }

        .fullscreen {
            z-index: 5;
            position: absolute;
            top: 8px;
            right: 24px;
            -webkit-user-select: none; /*Chrome/ Safari/ Opear新版本*/
            -moz-user-select: none; /*Foxfire */
            -ms-user-select: none; /*Internet Explorer/ Edge*/
            -o-user-select: none; /*Opear老版本*/
            -khtml-user-select: none; /* Konqueror */
            -webkit-touch-callout: none; /* iOS Safari */
            user-select: none;
        }

        .fullscreen[data-theme=dark] i {
            padding: 5px;
            color: #999;
        }

        .fullscreen[data-theme=dark] i:hover {
            cursor: pointer;
            color: #ddd;
        }

        .fullscreen[data-theme=dark] .active {
            color: #fff !important;
            /* font-size: 18px; */
        }

        .fullscreen[data-theme=light] i {
            padding: 5px;
            color: #888;
        }

        .fullscreen[data-theme=light] i:hover {
            cursor: pointer;
            color: #555;
        }

        .fullscreen[data-theme=light] .active {
            color: #111 !important;
            /* font-size: 18px; */
        }

        .active[data-theme=light] {
            color: #111 !important;
            font-size: 18px;
        }

        .CodeMirror {
            font-family: Consolas, "Courier New", monospace;
            font-weight: normal;
            font-size: 14px;
            line-height: 19px;
            letter-spacing: 0px;
        }

        .CodeMirror pre {
            font-family: Consolas, "Courier New", monospace;
            font-weight: normal;
            font-size: 14px;
            line-height: 19px;
            letter-spacing: 0px;
        }

        .CodeMirror pre {
            padding: 0 4px 0 8px;
        }

        .CodeMirror-linenumber {
            padding: 0 5px 0 5px;
        }

        .CodeMirror-gutters {
            border-right: 1px solid #999 !important;
        }

        .CodeMirror pre.CodeMirror-placeholder {
            color: #888;
        }
    </style>
</head>
<body>
<div class="fullscreen" data-theme="dark">
    <i id="debugBtn" title="调试" class="fa fa-bug"></i>
    <!--<i id="fullscreenBtn" title="全屏/取消全屏" class="fa fa-arrows-alt"></i>-->
</div>
<div id="code-editor" class="code-mirror-editor"></div>
</body>
<script type="text/javascript" src="jquery/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="codemirror/lib/codemirror.js"></script>
<script type="text/javascript" src="codemirror/addon/comment/comment.js"></script>
<script type="text/javascript" src="codemirror/addon/dialog/dialog.js"></script>
<script type="text/javascript" src="codemirror/addon/display/placeholder.js"></script>
<script type="text/javascript" src="codemirror/addon/display/autorefresh.js"></script>
<script type="text/javascript" src="codemirror/addon/edit/matchbrackets.js"></script>
<script type="text/javascript" src="codemirror/addon/edit/closebrackets.js"></script>
<script type="text/javascript" src="codemirror/addon/edit/matchtags.js"></script>
<script type="text/javascript" src="codemirror/addon/edit/trailingspace.js"></script>
<script type="text/javascript" src="codemirror/addon/edit/closetag.js"></script>
<script type="text/javascript" src="codemirror/addon/fold/foldcode.js"></script>
<script type="text/javascript" src="codemirror/addon/fold/brace-fold.js"></script>
<script type="text/javascript" src="codemirror/addon/scroll/simplescrollbars.js"></script>
<script type="text/javascript" src="codemirror/addon/scroll/annotatescrollbar.js"></script>
<script type="text/javascript" src="codemirror/addon/search/search.js"></script>
<script type="text/javascript" src="codemirror/addon/search/jump-to-line.js"></script>
<script type="text/javascript" src="codemirror/addon/search/matchesonscrollbar.js"></script>
<script type="text/javascript" src="codemirror/addon/search/searchcursor.js"></script>
<script type="text/javascript" src="codemirror/addon/selection/active-line.js"></script>
<script type="text/javascript" src="codemirror/addon/selection/selection-pointer.js"></script>
<script type="text/javascript" src="codemirror/addon/wrap/hardwrap.js"></script>
<script type="text/javascript" src="codemirror/keymap/sublime.js"></script>
<script type="text/javascript">
    var editor;
    // 全屏/取消全屏
    var fullscreenFunc;

    function fullscreen(full) {
        var node = $("#fullscreenBtn");
        if (full === true) {
            node.addClass("active");
        } else if (full === false) {
            node.removeClass("active");
        } else {
            node.toggleClass("active");
        }
    }

    // 全屏事件
    $("#fullscreenBtn").on("click", function () {
        if (fullscreenFunc) {
            fullscreen();
            fullscreenFunc();
        }
    });

    // 初始化编辑器
    function initEditor(config, setEditorFunc) {
        if (config) {
            fullscreenFunc = config.fullscreen;
        }
        var options = {
            lineNumbers: true,
            matchBrackets: true,
            styleActiveLine: true,
            indentUnit: 2,
            smartIndent: true,
            autoCloseBrackets: true,
            readOnly: false,
            placeholder: "输入代码...",
            value: "",
            scrollbarStyle: "overlay",
            selectionPointer: true,
            keyMap: "sublime"
            // continueLineComment: true,
            // theme: "monokai",
            // mode: codeTypeMap.JavaScript.mode,
            // modeJs: codeTypeMap.JavaScript.js,
        };
        options = $.extend(true, options, config);
        editor = CodeMirror(document.getElementById('code-editor'), options);
        editor.setSize("100%", "100%");
        if (setEditorFunc) setEditorFunc(editor);
        // 设置主题
        setTheme(options.theme || "monokai", true);
        // 设置模式(代码语言)
        setMode(options.mode || codeTypeMap.JavaScript.mode, options.modeJs || codeTypeMap.JavaScript.js);
        return editor;
    }

    var themeUrlMap = {
        "3024-day": {theme: "3024-day", url: "codemirror/theme/3024-day.css", fullscreen: "light"},
        "3024-night": {theme: "3024-night", url: "codemirror/theme/3024-night.css", fullscreen: "dark"},
        "abcdef": {theme: "abcdef", url: "codemirror/theme/abcdef.css", fullscreen: "dark"},
        "ambiance-mobile": {theme: "ambiance-mobile", url: "codemirror/theme/ambiance-mobile.css", fullscreen: "dark"},
        "ambiance": {theme: "ambiance", url: "codemirror/theme/ambiance.css", fullscreen: "dark"},
        "base16-dark": {theme: "base16-dark", url: "codemirror/theme/base16-dark.css", fullscreen: "dark"},
        "base16-light": {theme: "base16-light", url: "codemirror/theme/base16-light.css", fullscreen: "light"},
        "bespin": {theme: "bespin", url: "codemirror/theme/bespin.css", fullscreen: "dark"},
        "blackboard": {theme: "blackboard", url: "codemirror/theme/blackboard.css", fullscreen: "dark"},
        "cobalt": {theme: "cobalt", url: "codemirror/theme/cobalt.css", fullscreen: "dark"},
        "colorforth": {theme: "colorforth", url: "codemirror/theme/colorforth.css", fullscreen: "dark"},
        "darcula": {theme: "darcula", url: "codemirror/theme/darcula.css", fullscreen: "dark"},
        "dracula": {theme: "dracula", url: "codemirror/theme/dracula.css", fullscreen: "dark"},
        "duotone-dark": {theme: "duotone-dark", url: "codemirror/theme/duotone-dark.css", fullscreen: "dark"},
        "duotone-light": {theme: "duotone-light", url: "codemirror/theme/duotone-light.css", fullscreen: "light"},
        "eclipse": {theme: "eclipse", url: "codemirror/theme/eclipse.css", fullscreen: "light",},
        "elegant": {theme: "elegant", url: "codemirror/theme/elegant.css", fullscreen: "light"},
        "erlang-dark": {theme: "erlang-dark", url: "codemirror/theme/erlang-dark.css", fullscreen: "dark"},
        "gruvbox-dark": {theme: "gruvbox-dark", url: "codemirror/theme/gruvbox-dark.css", fullscreen: "dark"},
        "hopscotch": {theme: "hopscotch", url: "codemirror/theme/hopscotch.css", fullscreen: "dark"},
        "icecoder": {theme: "icecoder", url: "codemirror/theme/icecoder.css", fullscreen: "dark"},
        "idea": {theme: "idea", url: "codemirror/theme/idea.css", fullscreen: "light"},
        "isotope": {theme: "isotope", url: "codemirror/theme/isotope.css", fullscreen: "dark"},
        "lesser-dark": {theme: "lesser-dark", url: "codemirror/theme/lesser-dark.css", fullscreen: "dark"},
        "liquibyte": {theme: "liquibyte", url: "codemirror/theme/liquibyte.css", fullscreen: "dark"},
        "lucario": {theme: "lucario", url: "codemirror/theme/lucario.css", fullscreen: "dark"},
        "material": {theme: "material", url: "codemirror/theme/material.css", fullscreen: "dark"},
        "mbo": {theme: "mbo", url: "codemirror/theme/mbo.css", fullscreen: "dark"},
        "mdn-like": {theme: "mdn-like", url: "codemirror/theme/mdn-like.css", fullscreen: "light"},
        "midnight": {theme: "midnight", url: "codemirror/theme/midnight.css", fullscreen: "dark"},
        "monokai": {theme: "monokai", url: "codemirror/theme/monokai.css", loaded: true, fullscreen: "dark"},
        "neat": {theme: "neat", url: "codemirror/theme/neat.css", fullscreen: "light"},
        "neo": {theme: "neo", url: "codemirror/theme/neo.css", fullscreen: "light"},
        "night": {theme: "night", url: "codemirror/theme/night.css", fullscreen: "dark"},
        "nord": {theme: "nord", url: "codemirror/theme/nord.css", fullscreen: "dark"},
        "oceanic-next": {theme: "oceanic-next", url: "codemirror/theme/oceanic-next.css", fullscreen: "dark"},
        "panda-syntax": {theme: "panda-syntax", url: "codemirror/theme/panda-syntax.css", fullscreen: "dark"},
        "paraiso-dark": {theme: "paraiso-dark", url: "codemirror/theme/paraiso-dark.css", fullscreen: "dark"},
        "paraiso-light": {theme: "paraiso-light", url: "codemirror/theme/paraiso-light.css", fullscreen: "light"},
        "pastel-on-dark": {theme: "pastel-on-dark", url: "codemirror/theme/pastel-on-dark.css", fullscreen: "dark"},
        "railscasts": {theme: "railscasts", url: "codemirror/theme/railscasts.css", fullscreen: "dark"},
        "rubyblue": {theme: "rubyblue", url: "codemirror/theme/rubyblue.css", fullscreen: "dark"},
        "seti": {theme: "seti", url: "codemirror/theme/seti.css", fullscreen: "dark"},
        "shadowfox": {theme: "shadowfox", url: "codemirror/theme/shadowfox.css", fullscreen: "dark"},
        "solarized": {theme: "solarized", url: "codemirror/theme/solarized.css", fullscreen: "light"},
        "ssms": {theme: "ssms", url: "codemirror/theme/ssms.css", fullscreen: "light"},
        "the-matrix": {theme: "the-matrix", url: "codemirror/theme/the-matrix.css", fullscreen: "dark"},
        "tomorrow-night-bright": {theme: "tomorrow-night-bright", url: "codemirror/theme/tomorrow-night-bright.css", fullscreen: "dark"},
        "tomorrow-night-eighties": {theme: "tomorrow-night-eighties", url: "codemirror/theme/tomorrow-night-eighties.css", fullscreen: "dark"},
        "ttcn": {theme: "ttcn", url: "codemirror/theme/ttcn.css", fullscreen: "light"},
        "twilight": {theme: "twilight", url: "codemirror/theme/twilight.css", fullscreen: "dark"},
        "vibrant-ink": {theme: "vibrant-ink", url: "codemirror/theme/vibrant-ink.css", fullscreen: "dark"},
        "xq-dark": {theme: "xq-dark", url: "codemirror/theme/xq-dark.css", fullscreen: "dark"},
        "xq-light": {theme: "xq-light", url: "codemirror/theme/xq-light.css", fullscreen: "light"},
        "yeti": {theme: "yeti", url: "codemirror/theme/yeti.css", fullscreen: "light"},
        "yonce": {theme: "yonce", url: "codemirror/theme/yonce.css", fullscreen: "dark"},
        "zenburn": {theme: "zenburn", url: "codemirror/theme/zenburn.css", fullscreen: "dark"}
    };
    var themeArray = [
        "3024-day", "3024-night", "abcdef", "ambiance-mobile", "ambiance", "base16-dark", "base16-light", "bespin", "blackboard", "cobalt", "colorforth",
        "darcula", "dracula", "duotone-dark", "duotone-light", "eclipse", "elegant", "erlang-dark", "gruvbox-dark", "hopscotch", "icecoder", "idea",
        "isotope", "lesser-dark", "liquibyte", "lucario", "material", "mbo", "mdn-like", "midnight", "monokai", "neat", "neo", "night", "nord", "oceanic-next",
        "panda-syntax", "paraiso-dark", "paraiso-light", "pastel-on-dark", "railscasts", "rubyblue", "seti", "shadowfox", "solarized", "ssms", "the-matrix",
        "tomorrow-night-bright", "tomorrow-night-eighties", "ttcn", "twilight", "vibrant-ink", "xq-dark", "xq-light", "yeti", "yonce", "zenburn"
    ];

    // 设置编辑器主题
    function setTheme(theme, force) {
        if (themeArray.indexOf(theme) === -1) return;
        var oldTheme = editor.getOption("theme");
        if (theme === oldTheme && force !== true) return;
        // 动态加载 css
        var themeOpt = themeUrlMap[theme];
        // dark light
        $(".fullscreen").attr("data-theme", themeOpt.fullscreen || "dark");
        if (themeOpt.loaded !== true) {
            themeOpt.loaded = true;
            var head = document.getElementsByTagName('head')[0];
            var link = document.createElement('link');
            link.type = 'text/css';
            link.rel = 'stylesheet';
            link.href = themeOpt.url;
            head.appendChild(link);
        }
        // 设置主题
        editor.setOption("theme", theme);
    }

    var codeTypeMap = {
        C: {mode: "text/x-csrc", js: "clike"},
        "C++": {mode: "text/x-c++src", js: "clike"},
        "C#": {mode: "text/x-csharp", js: "clike"},
        Java: {mode: "text/x-java", js: "clike"},
        "Objective-C": {mode: "text/x-objectivec", js: "clike"},
        Scala: {mode: "text/x-scala", js: "clike"},
        Squirrel: {mode: "text/x-squirrel", js: "clike"},
        Ceylon: {mode: "text/x-ceylon", js: "clike"},
        Kotlin: {mode: "text/x-kotlin", js: "clike"},
        CSS: {mode: "text/css", js: "css"},
        SCSS: {mode: "text/x-scss", js: "css"},
        Less: {mode: "text/x-less", js: "css"},
        Django: {mode: "text/x-django", js: "django"},
        Erlang: {mode: "text/x-erlang", js: "erlang"},
        Go: {mode: "text/x-go", js: "go"},
        Groovy: {mode: "text/x-groovy", js: "groovy"},
        "ASP.NET": {mode: "application/x-aspx", js: "htmlembedded"},
        EJS: {mode: "application/x-ejs", js: "htmlembedded"},
        JSP: {mode: "application/x-jsp", js: "htmlembedded"},
        ERB: {mode: "application/x-erb", js: "htmlembedded"},
        "HTML-CSS-JS": {mode: "text/html", js: "htmlmixed"},
        HTTP: {mode: "message/http", js: "http"},
        JavaScript: {mode: "text/javascript", js: "javascript"},
        Json: {mode: "application/json", js: "javascript"},
        TypeScript: {mode: "text/typescript", js: "javascript"},
        Lua: {mode: "text/x-lua", js: "lua"},
        Markdown: {mode: "text/x-markdown", js: "markdown"},
        Nginx: {mode: "text/x-nginx-conf", js: "nginx"},
        "HTML-PHP": {mode: "application/x-httpd-php", js: "php"},
        PHP: {mode: "text/x-php", js: "php"},
        PowerShell: {mode: "application/x-powershell", js: "powershell"},
        Protobuf: {mode: "text/x-protobuf", js: "protobuf"},
        Python: {mode: "text/x-python", js: "python"},
        Cython: {mode: "text/x-cython", js: "python"},
        R: {mode: "text/x-rsrc", js: "r"},
        Ruby: {mode: "text/x-ruby", js: "ruby"},
        Rust: {mode: "text/x-rustsrc", js: "rust"},
        Sass: {mode: "text/x-sass", js: "sass"},
        Shell: {mode: "text/x-sh", js: "shell"},
        Solr: {mode: "text/x-solr", js: "solr"},
        SQL: {mode: "text/x-sql", js: "sql"},
        MySql: {mode: "text/x-mysql", js: "sql"},
        MariaDB: {mode: "text/x-mariadb", js: "sql"},
        Cassandra: {mode: "text/x-cassandra", js: "sql"},
        PLSQL: {mode: "text/x-plsql", js: "sql"},
        MSSql: {mode: "text/x-mssql", js: "sql"},
        PGSql: {mode: "text/x-pgsql", js: "sql"},
        HIVE: {mode: "text/x-hive", js: "sql"},
        GQL: {mode: "text/x-gql", js: "sql"},
        GPSql: {mode: "text/x-gpsql", js: "sql"},
        Esper: {mode: "text/x-esper", js: "sql"},
        Swift: {mode: "text/x-swift", js: "swift"},
        "VB.NET": {mode: "text/x-vb", js: "vb"},
        Velocity: {mode: "text/velocity", js: "velocity"},
        Vue: {mode: "text/x-vue", js: "vue"},
        XML: {mode: "application/xml", js: "xml"},
        HTML: {mode: "text/html", js: "xml"},
        YAML: {mode: "text/x-yaml", js: "yaml"}
        // 不全，根据官网添加 https://codemirror.net/mode/index.html
    };
    var modeJsUrlMap = {
        "apl": {mode: "apl", url: "codemirror/mode/apl/apl.js"},
        "asciiarmor": {mode: "asciiarmor", url: "codemirror/mode/asciiarmor/asciiarmor.js"},
        "asn.1": {mode: "asn.1", url: "codemirror/mode/asn.1/asn.1.js"},
        "asterisk": {mode: "asterisk", url: "codemirror/mode/asterisk/asterisk.js"},
        "brainfuck": {mode: "brainfuck", url: "codemirror/mode/brainfuck/brainfuck.js"},
        "clike": {mode: "clike", url: "codemirror/mode/clike/clike.js"},
        "clojure": {mode: "clojure", url: "codemirror/mode/clojure/clojure.js"},
        "cmake": {mode: "cmake", url: "codemirror/mode/cmake/cmake.js"},
        "cobol": {mode: "cobol", url: "codemirror/mode/cobol/cobol.js"},
        "coffeescript": {mode: "coffeescript", url: "codemirror/mode/coffeescript/coffeescript.js"},
        "commonlisp": {mode: "commonlisp", url: "codemirror/mode/commonlisp/commonlisp.js"},
        "crystal": {mode: "crystal", url: "codemirror/mode/crystal/crystal.js"},
        "css": {mode: "css", url: "codemirror/mode/css/css.js"},
        "cypher": {mode: "cypher", url: "codemirror/mode/cypher/cypher.js"},
        "d": {mode: "d", url: "codemirror/mode/d/d.js"},
        "dart": {mode: "dart", url: "codemirror/mode/dart/dart.js"},
        "diff": {mode: "diff", url: "codemirror/mode/diff/diff.js"},
        "django": {mode: "django", url: "codemirror/mode/django/django.js"},
        "dockerfile": {mode: "dockerfile", url: "codemirror/mode/dockerfile/dockerfile.js"},
        "dtd": {mode: "dtd", url: "codemirror/mode/dtd/dtd.js"},
        "dylan": {mode: "dylan", url: "codemirror/mode/dylan/dylan.js"},
        "ebnf": {mode: "ebnf", url: "codemirror/mode/ebnf/ebnf.js"},
        "ecl": {mode: "ecl", url: "codemirror/mode/ecl/ecl.js"},
        "eiffel": {mode: "eiffel", url: "codemirror/mode/eiffel/eiffel.js"},
        "elm": {mode: "elm", url: "codemirror/mode/elm/elm.js"},
        "erlang": {mode: "erlang", url: "codemirror/mode/erlang/erlang.js"},
        "factor": {mode: "factor", url: "codemirror/mode/factor/factor.js"},
        "fcl": {mode: "fcl", url: "codemirror/mode/fcl/fcl.js"},
        "forth": {mode: "forth", url: "codemirror/mode/forth/forth.js"},
        "fortran": {mode: "fortran", url: "codemirror/mode/fortran/fortran.js"},
        "gas": {mode: "gas", url: "codemirror/mode/gas/gas.js"},
        "gfm": {mode: "gfm", url: "codemirror/mode/gfm/gfm.js"},
        "gherkin": {mode: "gherkin", url: "codemirror/mode/gherkin/gherkin.js"},
        "go": {mode: "go", url: "codemirror/mode/go/go.js"},
        "groovy": {mode: "groovy", url: "codemirror/mode/groovy/groovy.js"},
        "haml": {mode: "haml", url: "codemirror/mode/haml/haml.js"},
        "handlebars": {mode: "handlebars", url: "codemirror/mode/handlebars/handlebars.js"},
        "haskell": {mode: "haskell", url: "codemirror/mode/haskell/haskell.js"},
        "haskell-literate": {mode: "haskell-literate", url: "codemirror/mode/haskell-literate/haskell-literate.js"},
        "haxe": {mode: "haxe", url: "codemirror/mode/haxe/haxe.js"},
        "htmlembedded": {mode: "htmlembedded", url: "codemirror/mode/htmlembedded/htmlembedded.js"},
        "htmlmixed": {mode: "htmlmixed", url: "codemirror/mode/htmlmixed/htmlmixed.js"},
        "http": {mode: "http", url: "codemirror/mode/http/http.js"},
        "idl": {mode: "idl", url: "codemirror/mode/idl/idl.js"},
        "index.html": {mode: "index.html", url: "codemirror/mode/index.html/index.html.js"},
        "javascript": {mode: "javascript", url: "codemirror/mode/javascript/javascript.js"},
        "jinja2": {mode: "jinja2", url: "codemirror/mode/jinja2/jinja2.js"},
        "jsx": {mode: "jsx", url: "codemirror/mode/jsx/jsx.js"},
        "julia": {mode: "julia", url: "codemirror/mode/julia/julia.js"},
        "livescript": {mode: "livescript", url: "codemirror/mode/livescript/livescript.js"},
        "lua": {mode: "lua", url: "codemirror/mode/lua/lua.js"},
        "markdown": {mode: "markdown", url: "codemirror/mode/markdown/markdown.js"},
        "mathematica": {mode: "mathematica", url: "codemirror/mode/mathematica/mathematica.js"},
        "mbox": {mode: "mbox", url: "codemirror/mode/mbox/mbox.js"},
        "meta.js": {mode: "meta.js", url: "codemirror/mode/meta.js/meta.js.js"},
        "mirc": {mode: "mirc", url: "codemirror/mode/mirc/mirc.js"},
        "mllike": {mode: "mllike", url: "codemirror/mode/mllike/mllike.js"},
        "modelica": {mode: "modelica", url: "codemirror/mode/modelica/modelica.js"},
        "mscgen": {mode: "mscgen", url: "codemirror/mode/mscgen/mscgen.js"},
        "mumps": {mode: "mumps", url: "codemirror/mode/mumps/mumps.js"},
        "nginx": {mode: "nginx", url: "codemirror/mode/nginx/nginx.js"},
        "nsis": {mode: "nsis", url: "codemirror/mode/nsis/nsis.js"},
        "ntriples": {mode: "ntriples", url: "codemirror/mode/ntriples/ntriples.js"},
        "octave": {mode: "octave", url: "codemirror/mode/octave/octave.js"},
        "oz": {mode: "oz", url: "codemirror/mode/oz/oz.js"},
        "pascal": {mode: "pascal", url: "codemirror/mode/pascal/pascal.js"},
        "pegjs": {mode: "pegjs", url: "codemirror/mode/pegjs/pegjs.js"},
        "perl": {mode: "perl", url: "codemirror/mode/perl/perl.js"},
        "php": {mode: "php", url: "codemirror/mode/php/php.js"},
        "pig": {mode: "pig", url: "codemirror/mode/pig/pig.js"},
        "powershell": {mode: "powershell", url: "codemirror/mode/powershell/powershell.js"},
        "properties": {mode: "properties", url: "codemirror/mode/properties/properties.js"},
        "protobuf": {mode: "protobuf", url: "codemirror/mode/protobuf/protobuf.js"},
        "pug": {mode: "pug", url: "codemirror/mode/pug/pug.js"},
        "puppet": {mode: "puppet", url: "codemirror/mode/puppet/puppet.js"},
        "python": {mode: "python", url: "codemirror/mode/python/python.js"},
        "q": {mode: "q", url: "codemirror/mode/q/q.js"},
        "r": {mode: "r", url: "codemirror/mode/r/r.js"},
        "rpm": {mode: "rpm", url: "codemirror/mode/rpm/rpm.js"},
        "rst": {mode: "rst", url: "codemirror/mode/rst/rst.js"},
        "ruby": {mode: "ruby", url: "codemirror/mode/ruby/ruby.js"},
        "rust": {mode: "rust", url: "codemirror/mode/rust/rust.js"},
        "sas": {mode: "sas", url: "codemirror/mode/sas/sas.js"},
        "sass": {mode: "sass", url: "codemirror/mode/sass/sass.js"},
        "scheme": {mode: "scheme", url: "codemirror/mode/scheme/scheme.js"},
        "shell": {mode: "shell", url: "codemirror/mode/shell/shell.js"},
        "sieve": {mode: "sieve", url: "codemirror/mode/sieve/sieve.js"},
        "slim": {mode: "slim", url: "codemirror/mode/slim/slim.js"},
        "smalltalk": {mode: "smalltalk", url: "codemirror/mode/smalltalk/smalltalk.js"},
        "smarty": {mode: "smarty", url: "codemirror/mode/smarty/smarty.js"},
        "solr": {mode: "solr", url: "codemirror/mode/solr/solr.js"},
        "soy": {mode: "soy", url: "codemirror/mode/soy/soy.js"},
        "sparql": {mode: "sparql", url: "codemirror/mode/sparql/sparql.js"},
        "spreadsheet": {mode: "spreadsheet", url: "codemirror/mode/spreadsheet/spreadsheet.js"},
        "sql": {mode: "sql", url: "codemirror/mode/sql/sql.js"},
        "stex": {mode: "stex", url: "codemirror/mode/stex/stex.js"},
        "stylus": {mode: "stylus", url: "codemirror/mode/stylus/stylus.js"},
        "swift": {mode: "swift", url: "codemirror/mode/swift/swift.js"},
        "tcl": {mode: "tcl", url: "codemirror/mode/tcl/tcl.js"},
        "textile": {mode: "textile", url: "codemirror/mode/textile/textile.js"},
        "tiddlywiki": {mode: "tiddlywiki", url: "codemirror/mode/tiddlywiki/tiddlywiki.js"},
        "tiki": {mode: "tiki", url: "codemirror/mode/tiki/tiki.js"},
        "toml": {mode: "toml", url: "codemirror/mode/toml/toml.js"},
        "tornado": {mode: "tornado", url: "codemirror/mode/tornado/tornado.js"},
        "troff": {mode: "troff", url: "codemirror/mode/troff/troff.js"},
        "ttcn": {mode: "ttcn", url: "codemirror/mode/ttcn/ttcn.js"},
        "ttcn-cfg": {mode: "ttcn-cfg", url: "codemirror/mode/ttcn-cfg/ttcn-cfg.js"},
        "turtle": {mode: "turtle", url: "codemirror/mode/turtle/turtle.js"},
        "twig": {mode: "twig", url: "codemirror/mode/twig/twig.js"},
        "vb": {mode: "vb", url: "codemirror/mode/vb/vb.js"},
        "vbscript": {mode: "vbscript", url: "codemirror/mode/vbscript/vbscript.js"},
        "velocity": {mode: "velocity", url: "codemirror/mode/velocity/velocity.js"},
        "verilog": {mode: "verilog", url: "codemirror/mode/verilog/verilog.js"},
        "vhdl": {mode: "vhdl", url: "codemirror/mode/vhdl/vhdl.js"},
        "vue": {mode: "vue", url: "codemirror/mode/vue/vue.js"},
        "webidl": {mode: "webidl", url: "codemirror/mode/webidl/webidl.js"},
        "xml": {mode: "xml", url: "codemirror/mode/xml/xml.js"},
        "xquery": {mode: "xquery", url: "codemirror/mode/xquery/xquery.js"},
        "yacas": {mode: "yacas", url: "codemirror/mode/yacas/yacas.js"},
        "yaml": {mode: "yaml", url: "codemirror/mode/yaml/yaml.js"},
        "yaml-frontmatter": {mode: "yaml-frontmatter", url: "codemirror/mode/yaml-frontmatter/yaml-frontmatter.js"},
        "z80": {mode: "z80", url: "codemirror/mode/z80/z80.js"}
    };
    var modeArray = [
        "apl", "asciiarmor", "asn.1", "asterisk", "brainfuck", "clike", "clojure", "cmake", "cobol", "coffeescript", "commonlisp", "crystal", "css", "cypher",
        "d", "dart", "diff", "django", "dockerfile", "dtd", "dylan", "ebnf", "ecl", "eiffel", "elm", "erlang", "factor", "fcl", "forth", "fortran", "gas",
        "gfm", "gherkin", "go", "groovy", "haml", "handlebars", "haskell", "haskell-literate", "haxe", "htmlembedded", "htmlmixed", "http", "idl", "index.html",
        "javascript", "jinja2", "jsx", "julia", "livescript", "lua", "markdown", "mathematica", "mbox", "meta.js", "mirc", "mllike", "modelica", "mscgen",
        "mumps", "nginx", "nsis", "ntriples", "octave", "oz", "pascal", "pegjs", "perl", "php", "pig", "powershell", "properties", "protobuf", "pug", "puppet",
        "python", "q", "r", "rpm", "rst", "ruby", "rust", "sas", "sass", "scheme", "shell", "sieve", "slim", "smalltalk", "smarty", "solr", "soy", "sparql",
        "spreadsheet", "sql", "stex", "stylus", "swift", "tcl", "textile", "tiddlywiki", "tiki", "toml", "tornado", "troff", "ttcn", "ttcn-cfg", "turtle",
        "twig", "vb", "vbscript", "velocity", "verilog", "vhdl", "vue", "webidl", "xml", "xquery", "yacas", "yaml", "yaml-frontmatter", "z80"
    ];

    // 设置编辑器代码语言
    function setMode(mode, js) {
        if (modeArray.indexOf(js) === -1) return;
        // 动态加载 js
        var modeOpt = modeJsUrlMap[js];
        if (modeOpt.loaded !== true) {
            modeOpt.loaded = true;
            var head = document.getElementsByTagName('head')[0];
            var script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = modeOpt.url;
            script.onload = script.onreadystatechange = function () {
                if (!this.readyState || this.readyState === "loaded" || this.readyState === "complete") {
                    script.onload = script.onreadystatechange = null;
                    // 设置模式
                    editor.setOption("mode", mode);
                }
            };
            head.appendChild(script);
        }
    }

    // 设置code内容
    function setValue(value) {
        editor.setValue(value || "");
    }

    // 读取code内容
    function getValue() {
        return editor.getValue();
    }

    // --------------------------------------------------------------------------------------------------------------

    var isDebug = false;

    function debug() {
        isDebug = true;
        var ws = new WebSocket("ws://127.0.0.1:18081/ws/debug");
        ws.onopen = function () {
            console.log("已连接服务器...");
            ws.send(JSON.stringify({
                type: 'normal',
                filePath: '/',
                fileName: './public/tmp.js',
                fucName: 'test'
            }));
        };

        ws.onmessage = function (evt) {
            var data = JSON.parse(evt.data);
            // console.log(data.log);
            // console.log(data.logs);
            if (data.type === "log") {
                var _console;
                switch (data.level) {
                    case "trace":
                        (_console = console).trace.apply(_console, data.logs);
                        break;
                    case "debug":
                        (_console = console).debug.apply(_console, data.logs);
                        break;
                    case "info":
                        (_console = console).info.apply(_console, data.logs);
                        break;
                    case "warn":
                        (_console = console).warn.apply(_console, data.logs);
                        break;
                    case "error":
                        (_console = console).error.apply(_console, data.logs);
                        break;
                    default:
                        (_console = console).log.apply(_console, data.logs);
                }
            }
        };

        ws.onclose = function (evt) {
            isDebug = false;
            console.warn("关闭与服务器的连接！");
        };

        ws.onerror = function (evt) {
            console.error("连接服务器错误", evt);
        };
    }

    initEditor({
        width: "100%",
        height: "100%"
    });

    var id = 12;
    $.ajax({
        url: "/api/js_code_file/" + id,
        type: "GET",
        async: true,
        contentType: "application/json; charset=utf-8",
        // data: JSON.stringify({}),
        dataType: "json",
        success: function (result) {
            // console.log(result);
            setValue(result.jsCode);
        }
    });

    $("#debugBtn").on("click", function () {
        if (isDebug) return;
        // 保存数据
        $.ajax({
            url: "/api/js_code_file/" + id,
            type: "PUT",
            async: true,
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({jsCode: getValue()}),
            dataType: "json",
            success: function (result) {
                debug();
                vConsole.show();
            }
        });
    });
</script>
</html>